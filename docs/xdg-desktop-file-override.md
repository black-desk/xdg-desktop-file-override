# `xdg-desktop-file-override`

xdg-desktop-file-override read a configuration file at
`$XDG_CONFIG_DIRS/xdg-desktop-file-override/config.yaml`
and generate new desktop file from existing desktop files to
`$XDG_DATA_HOME/applications` according to that configuration file.

The configuration file is a yaml file looks like this:

```yaml
# Version of configuration file.
version: 0.1.0

# Generator has a `name`, a regex `filter` and a `command`.
# It is recommend to use `sed -e` as command.
generators:
  - name: remove-all-dbusactivatable-equals-true
    filter: .*
    command: [ 'sed',
      '-e', '/DBusActivatable=true/d',
    ]
  - filter: ^zed\.desktop$
    name: fix-zeditor
    command: [ 'sed',
      # Add missing StartupWMClass
      '-e', '/\[Desktop Entry\]/a StartupWMClass=dev.zed.Zed',
      # Remove StartupNotify
      '-e', '/StartupNotify=true/d',
    ]
```

As the desktop entry specification says,
these new files will override the old one provided by system or packager.

It can be use to:

1. Customize the command used to run some desktop application;
2. Fix application with wrong StartupWMClass/StartupNotify property.

## Implement details

`xdg-desktop-file-override` will go through all the desktop files
found in `XDG_DATA_DIRS` (`XDG_DATA_HOME` is ignored) one by one.
And try pipe the content of original desktop file into generator process
if the file name of desktop file matched the regex filter.
If the generator return non-zero exit code,
the generator will be ignored,
else the stdout of generator will be treated as new desktop file content
and pipe to later matched generators until all generators are processed.
Then the new desktop file will be written to `$XDG_DATA_HOME/applications`
with an extra property `X-XDG-Desktop-File-Override-Version=<version>`.

This program will not overwrite existing file in `$XDG_DATA_HOME/applications`
which is not generated by itself.
